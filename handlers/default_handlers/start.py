from loguru import logger
from telebot.types import Message
from keyboards.inline.keyboard_all_command import name_all_commands
from loader import bot
from states.states2start import UserStates


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@logger.catch()
@bot.message_handler(commands=["start"])
def command_start(message: Message) -> None:
    """
    –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    –ò –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ UserStates.start_bot

    Parameters:
        message (Message): –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        None
    """
    try:
        logger.warning("–ù–∞—á–∞–ª–æ command /start")
        bot.set_state(message.from_user.id, UserStates.start_bot, message.chat.id)
        logger.debug("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user} –∏–∑–º–µ–Ω–∏–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ start_bot".format(user=message.from_user.first_name))

        # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        main_keyboard = name_all_commands()
        logger.debug("–°–æ–∑–¥–∞–ª–∞—Å—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞")

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        good_mess = "{user}, –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç-–±–æ—Ç Share Airplane! üõ©Ô∏è\n" \
                    "\n–ú—ã —Ä–∞–¥—ã –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è–º–∏ –∏ –≥–æ—Ç–æ–≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–ª–µ—Ç–∞—Ö. " \
                    "–í –Ω–∞—à–µ–º –±–æ—Ç–µ —Ç—ã –º–æ–∂–µ—à—å –Ω–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–π –∞—ç—Ä–æ–ø–æ—Ä—Ç –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –∏–ª–∏ –±—É–¥—É—â–µ–≥–æ —Ä–µ–π—Å–∞ –ø–æ –µ–≥–æ –Ω–æ–º–µ—Ä—É –∏ –¥–∞—Ç–µ.\n" \
                    "\n–ü—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å –≤—ã–±—Ä–∞–≤ –∏–∑ –º–µ–Ω—é –Ω—É–∂–Ω—É—é –∫–æ–º–∞–Ω–¥—É, –∏ –º—ã –ø–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–±–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. " \
                    "–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ –ø–µ—Ä–µ–ª–µ—Ç–∞—Ö, —á—Ç–æ–±—ã —Ç–≤–æ—ë –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –±—ã–ª–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.\n" \
                    "\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –∏ –ø—Ä–∏—è—Ç–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π!ü´∂üèΩÔ∏è".format(user=message.from_user.first_name, )
        bot.send_message(message.chat.id, good_mess, reply_markup=main_keyboard)
        logger.debug("–û—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π")



    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ /start")
        logger.exception(e)

    finally:
        # –£–¥–∞–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        logger.warning("–ö–æ–Ω–µ—Ü command /start")
        bot.delete_state(message.from_user.id, message.chat.id)


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback /start –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–∫–∏ –≤ –º–µ–Ω—é
@logger.catch()
@bot.callback_query_handler(func=lambda call: call.data == "/start")
def callback_start(call) -> None:
    """
    –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –∑–∞–ø—Ä–æ—Å–∞ /start
    –ò –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ UserStates.start_bot

    Parameters:
        call: –û–±—ä–µ–∫—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ callback –∑–∞–ø—Ä–æ—Å–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        None
    """
    try:
        logger.warning("–ù–∞—á–∞–ª–æ callback /start")
        bot.set_state(call.from_user.id, UserStates.start_bot, call.message.chat.id)
        logger.debug("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user} –∏–∑–º–µ–Ω–∏–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ start_bot".format(user=call.from_user.first_name))

        # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        main_keyboard = name_all_commands()
        logger.debug("–°–æ–∑–¥–∞–ª–∞—Å—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞")

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        good_mess = "{user}, –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç-–±–æ—Ç Share Airplane! üõ©Ô∏è\n" \
                    "\n–ú—ã —Ä–∞–¥—ã –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è–º–∏ –∏ –≥–æ—Ç–æ–≤—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–ª–µ—Ç–∞—Ö. " \
                    "–í –Ω–∞—à–µ–º –±–æ—Ç–µ —Ç—ã –º–æ–∂–µ—à—å –Ω–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–π –∞—ç—Ä–æ–ø–æ—Ä—Ç –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –∏–ª–∏ –±—É–¥—É—â–µ–≥–æ —Ä–µ–π—Å–∞ –ø–æ –µ–≥–æ –Ω–æ–º–µ—Ä—É –∏ –¥–∞—Ç–µ.\n" \
                    "\n–ü—Ä–æ—Å—Ç–æ —É–∫–∞–∂–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å –≤—ã–±—Ä–∞–≤ –∏–∑ –º–µ–Ω—é –Ω—É–∂–Ω—É—é –∫–æ–º–∞–Ω–¥—É, –∏ –º—ã –ø–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–±–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. " \
                    "–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ –ø–µ—Ä–µ–ª–µ—Ç–∞—Ö, —á—Ç–æ–±—ã —Ç–≤–æ—ë –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –±—ã–ª–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.\n" \
                    "\n–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –∏ –ø—Ä–∏—è—Ç–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π!ü´∂üèΩÔ∏è".format(user=call.from_user.first_name, )
        bot.send_message(call.message.chat.id, good_mess, reply_markup=main_keyboard)
        logger.debug("–û—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π")



    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ /start")
        logger.exception(e)

    finally:
        # –£–¥–∞–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        logger.warning("–ö–æ–Ω–µ—Ü callback /start")
        bot.delete_state(call.from_user.id)
